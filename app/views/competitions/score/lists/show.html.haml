= render 'competitions/header', competition: @competition, sub: resource_class.model_name.human(count: :many)

.row.g-4
  .col-md-8
    = card( @list.name) do |card|
      - if can?(:edit, @list) || !@list.hidden?
        - card.direct do
          %table.table.much-data
            = render 'list_headline', times: true, list: @list
            %tbody
              - score_list_entries(@list) do |entry, run, track, best_of_run|
                = render layout: 'list_entry', locals: { entry:, run:, track:, list: @list, best_of_run: } do
                  - if @list.separate_target_times?
                    %td.separate-times
                      = entry&.human_time_left_target
                      %br
                      = entry&.human_time_right_target
                  %td.time-col
                    = entry&.human_time
                  - if can?(:edit, @list) && can?(:edit_times, @list)
                    %td.text-end
                      - if track == 1 && params[:destroy_index].nil?
                        = short_edit_link edit_competition_score_list_run_path(list_id: @list.id, run:), title: 'Zeiten bearbeiten', class: 'btn-xs'
                      - if entry.present? && params[:destroy_index]
                        = short_destroy_link destroy_entity_competition_score_list_path(id: @list, entry_id: entry.id), title: 'Aus Liste entfernen', class: 'btn-xs'
        - card.actions do |actions|
          = actions.link_to 'als PDF', { format: :pdf }, target: '_blank', rel: 'noopener'
          = actions.link_to 'als XLS', format: :xlsx
      - else
        - card.body do
          %p Diese Startliste ist derzeit nicht öffentlich einsehbar.
  .col-md-3
    - if can?(:edit, @list)
      - if @list.hidden?
        = card('Versteckt', class: "mb-3 text-bg-warning") do |card|
          - card.body do
            %p Die Startliste ist derzeit noch versteckt. Bitte geben Sie diese nach der Kontrolle frei.
            - if can?(:edit, @list)
              = btn_link_to 'Bearbeiten', { action: :edit }


      = card(t('a.actions'), class: 'mb-3') do |card|
        - card.primary_actions do |actions|
          - actions.link_to 'Übersicht', { action: :index }, end_icon: :list
        - card.body do
          .d-grid.gap-2
            - if can?(:edit, @list)
              = btn_link_to 'Reihenfolge bearbeiten', { action: :move }
            - if can?(:edit_times, @list)
              = btn_link_to 'Zeiten im Block eintragen', { action: :edit_times }
            - if can?(:edit, @list)
              = btn_link_to 'Teilnehmer hinzufügen', { action: :select_entity }, remote: true
            - if params[:destroy_index]
              = btn_link_to 'Zeiten eintragen', { action: :show }
            - else
              = btn_link_to 'Teilnehmer entfernen', { action: :show, destroy_index: 1 }
            - if can?(:copy, @list)
              = btn_link_to 'Startliste klonen', copy_list_competition_score_list_factories_path(list_id: @list.id)
        - card.actions do |actions|
          = actions.link_to 'PDF', { format: :pdf }, target: '_blank', rel: 'noopener'
          = actions.link_to 'PDF für Kampfrichter', { format: :pdf, more_columns: true }, target: '_blank', rel: 'noopener'
          = actions.link_to 'XLS', format: :xlsx

      - if can?(:edit, @list)
        = card('Allgemein', class: 'mb-3') do |card|
          - card.body do
            .d-grid.gap-2
              = btn_link_to 'Bearbeiten', { action: :edit }
              - if can?(:destroy, @list)
                = btn_link_to 'Löschen', { action: :destroy }, method: :delete, data: { confirm: 'Startliste wirklich löschen? Alle bisher eingetragenen Zeiten dieser Liste gehen verloren!' }

    - if @list.results.present?
      = card('Ergebnisse') do |card|
        - card.body do
          .d-grid.gap-2
            - @list.results.each do |result|
              = btn_link_to(result.name, competition_score_result_path(id: result.id))
